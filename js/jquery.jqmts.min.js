/*
 * jquery.jqmts
 * https://github.com/commadelimited/jQuery-Mobile-Tiny-Sort
 * Version: 0.5
 *
 * Copyright (c) 2012 andy matthews
 * Licensed under the MIT license.
 * Packed with: http://jsutility.pjoneil.net/
 */
(function($,window){"use strict";var defaults={useNativeMenu:false,attributes:{},showCounts:true,className:'jqmts'},buildMenu=function($el,options){var $select=$('<li></li>').addClass(options.className).prepend($('<select></select>').attr({'id':$el.attr('id')+'-sort'}).data('native-menu',options.useNativeMenu).html(function(){var str=[];for(var o in options.attributes){str.push('<option value="'+o+'">'+options.attributes[o]+'</option>')}return str.join('')}).on('change',function(e){$('li:not(.'+options.className+')',$el).tsort({data:'sort-'+e.currentTarget.value})}));$el.prepend($select).trigger('create').listview('refresh')},compileKeys=function($el,options){var $list=$('li:not(.'+options.className+')',$el),$dropdown=$('#'+$el.attr('id')+'-sort'),scope=window;$list.each(function(i,el){var $li=$(this);for(var d in $li.data()){if(d.indexOf('sort')>=0){if(!scope[d]){scope[d]={};if(typeof scope.sortKeys=="undefined")scope.sortKeys={};scope.sortKeys[d]=d}else{scope[d][$li.data(d)]=$li.data(d)}}}});if(typeof scope.sortKeys!="undefined"){for(var s in scope.sortKeys){var prep=s.toLowerCase().replace('sort','');$('option[value='+prep+']',$dropdown).text(function(i,old){var value=$(this).val();return old+' ('+Object.keys(scope[s]).length+')'})}$dropdown.selectmenu('refresh')}},methods={init:function(options){if(typeof window.jQuery.tinysort!='object'){window.alert('TinySort is not defined.\nhttp://tinysort.sjeiti.com/');return}this.jqmData("jqmts",$.extend({},defaults,options));buildMenu(this,this.jqmData("jqmts"));if(options.showCounts)compileKeys(this,this.jqmData("jqmts"));return this}};$.fn.jqmts=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}}})(jQuery,window);